# HW07 – Report

> Файл: `homeworks/HW07/report.md`  
> Важно: не меняйте названия разделов (заголовков). Заполняйте текстом и/или вставляйте результаты.

## 1. Datasets

Вы выбрали 3 датасета из 4: ds02, ds03, ds04.

### 1.1 Dataset A (ds02)

- Файл: `data/S07-hw-dataset-02.csv`
- Размер: (8000, 4)
- Признаки: числовые (`x1`, `x2`, `z_noise`) + `sample_id` (служебный).
- Пропуски: практически нет (по `df.isna().mean()` значения близки к 0).
- "Подлости" датасета: присутствует шумовой признак `z_noise`, кластеры частично перекрываются.

### 1.2 Dataset B (ds03)

- Файл: `data/S07-hw-dataset-03.csv`
- Размер: (15000, 5)
- Признаки: числовые (`x1`, `x2`, `f_corr`, `f_noise`) + `sample_id` (служебный).
- Пропуски: практически нет (по `df.isna().mean()` значения близки к 0).
- "Подлости" датасета: есть коррелированный признак `f_corr` и шумовой `f_noise`; кластеры частично пересекаются (видно по PCA).

### 1.3 Dataset C (ds04)

- Файл: `data/S07-hw-dataset-04.csv`
- Размер: (10000, 33)
- Признаки: числовые + `sample_id` (служебный).
- Пропуски: практически нет (по `df.isna().mean()` значения близки к 0).
- "Подлости" датасета: высокая размерность (33 признака) и потенциально неодинаковая плотность кластеров.

## 2. Protocol

- Препроцессинг:
  - Удалял `sample_id` из признаков.
  - Пайплайн через `ColumnTransformer`:
    - числовые: `SimpleImputer(median)` + `StandardScaler()`;
    - категориальные (если бы были): `SimpleImputer(most_frequent)` + `OneHotEncoder(handle_unknown="ignore")`.
- Поиск гиперпараметров:
  - KMeans: перебор `k` в диапазоне 2..20, выбор `k` по максимуму silhouette.
  - DBSCAN: перебор `eps` по сетке (0.5..5.0), `min_samples=5`, выбор по silhouette.
- Метрики:
  - считались `silhouette`, `Davies-Bouldin`, `Calinski-Harabasz`;
  - для DBSCAN при наличии шума (`label=-1`) метрики считались по не-шумовым точкам; дополнительно считалась доля шума `noise_share`.
- Визуализация:
  - PCA(2D) scatter для лучшего метода на каждом датасете.

Файлы с графиками (артефакты):
- ds02: `artifacts/figures/ds02_kmeans_silhouette_vs_k.png`, `artifacts/figures/ds02_dbscan_silhouette_vs_eps.png`, `artifacts/figures/ds02_pca_best.png`
- ds03: `artifacts/figures/ds03_kmeans_silhouette_vs_k.png`, `artifacts/figures/ds03_dbscan_silhouette_vs_eps.png`, `artifacts/figures/ds03_pca_best.png`
- ds04: `artifacts/figures/ds04_kmeans_silhouette_vs_k.png`, `artifacts/figures/ds04_dbscan_silhouette_vs_eps.png`, `artifacts/figures/ds04_pca_best.png`

## 3. Models

На каждом датасете сравнивались:

- KMeans:
  - подбирался `k` (2..20),
  - использовались фиксированные `random_state` и `n_init="auto"`.
- DBSCAN:
  - подбирался `eps`,
  - фиксировался `min_samples=5`,
  - анализировались метрики по не-шумовым точкам и доля шума.

## 4. Results

Итоговые метрики и выбранные конфиги сохранены в:
- `artifacts/metrics_summary.json`
- `artifacts/best_configs.json`

### 4.1 Dataset A (ds02)

- Лучший метод и параметры: KMeans, `k=2` (см. `artifacts/figures/ds02_kmeans_silhouette_vs_k.png`).
- Метрики:
  - silhouette: 0.3069
  - Davies-Bouldin: 1.3235
  - Calinski-Harabasz: 3573.3933
  - noise_share: 0.0
- DBSCAN: при подборе `eps` часто получалась неудачная конфигурация (много шума/недостаточно кластеров) — см. `artifacts/figures/ds02_dbscan_silhouette_vs_eps.png`.
- Визуализация лучшего решения: `artifacts/figures/ds02_pca_best.png`.
- Почему разумно: структура данных ближе к “компактным группам”, поэтому KMeans с небольшим `k` даёт адекватное разбиение.

### 4.2 Dataset B (ds03)

- Лучший метод и параметры: KMeans, `k=3` (см. `artifacts/figures/ds03_kmeans_silhouette_vs_k.png`).
- Метрики:
  - silhouette: 0.3155
  - Davies-Bouldin: 1.1578
  - Calinski-Harabasz: 6957.1581
  - noise_share: 0.0
- DBSCAN: по `artifacts/figures/ds03_dbscan_silhouette_vs_eps.png` видно, что качество по silhouette(no-noise) часто очень низкое (вплоть до -1), поэтому DBSCAN не выбран.
- Визуализация лучшего решения: `artifacts/figures/ds03_pca_best.png`.
- Почему разумно: по PCA видно несколько крупных групп с перекрытием; KMeans с `k=3` даёт наиболее согласованное разбиение по silhouette.

### 4.3 Dataset C (ds04)

- Лучший метод и параметры: DBSCAN, `eps=1.0`, `min_samples=5` (см. `artifacts/figures/ds04_dbscan_silhouette_vs_eps.png`).
- Метрики:
  - silhouette: 0.4936
  - Davies-Bouldin: 0.7018
  - Calinski-Harabasz: 15.3852
  - noise_share: 0.999
- Визуализация лучшего решения: `artifacts/figures/ds04_pca_best.png`.
- Комментарий по DBSCAN: `noise_share=0.999` означает, что почти все точки отмечены как шум, а метрики считались по очень малому числу не-шумовых точек, поэтому решение стоит интерпретировать аккуратно (возможно, стоит расширить сетку `eps`/подобрать другой `min_samples`).
- Почему разумно: на PCA(2D) видны плотные “островки”, и DBSCAN умеет находить такие плотные области без предположения о сферичности кластеров.


## 5. Analysis

### 5.1 Сравнение алгоритмов (важные наблюдения)

- KMeans лучше сработал на ds02 и ds03: есть понятный максимум silhouette, а на PCA(2D) видно несколько крупных групп (пусть и с частичным перекрытием), поэтому разбиение получается интерпретируемым.
- DBSCAN на ds02/ds03 при выбранной сетке `eps` часто давал слишком много шума или слишком мало кластеров (из-за чего silhouette для DBSCAN становился очень низким / неинформативным).
- На ds04 DBSCAN формально выбран лучшим, но `noise_share=0.999` означает, что почти все точки объявлены шумом, а метрики посчитаны по очень малому числу “не-шума”; это сигнал, что по этому датасету стоит осторожно интерпретировать итог и (в реальной задаче) расширить поиск `eps`/`min_samples` или попробовать другой алгоритм.
- Сильнее всего на результат влияли масштабирование признаков и выбранные диапазоны гиперпараметров (особенно `eps` у DBSCAN): при неподходящем `eps` DBSCAN легко переходит в режим “всё шум”.

### 5.2 Устойчивость (обязательно для одного датасета)

Проверка сделана для ds02.

- Проверка устойчивости: 5 запусков KMeans с одинаковым `k`, но разными `random_state` (seeds 0..4).
- Оценка: сравнение разметок через ARI относительно запуска с seed0.
- Результат: ARI получились высокими (примерно 0.71–0.96), значит разметка в целом устойчива.
- Вывод: решение KMeans для ds02 можно считать устойчивым, так как смена seed слабо влияет на итоговое разбиение.

### 5.3 Интерпретация кластеров

- Интерпретация выполнялась через PCA(2D) scatter: оценивалась визуальная разделимость и форма кластеров.
- Для ds04 кластеры выглядят как отдельные плотные группы (`ds04_pca_best.png`) → DBSCAN интерпретируется как выделение плотных областей.
- Для ds02/ds03 есть частичное перекрытие (`ds02_pca_best.png`, `ds03_pca_best.png`) → оптимум по silhouette достигается при умеренных `k`.

## 6. Conclusion

- Единый препроцессинг (imputer + scaler + общий пайплайн) важен для честного сравнения кластеризации.
- Silhouette удобно использовать для выбора `k` в KMeans, но для DBSCAN при большом шуме метрики могут вводить в заблуждение, поэтому нужно дополнительно анализировать `noise_share`.
- На ds02 и ds03 KMeans дал наилучшее и достаточно устойчивое решение (для ds02 устойчивость подтверждена ARI при разных seed).
- На ds04 выбран DBSCAN, но очень высокая доля шума показывает, что найденная конфигурация, вероятно, слишком “жёсткая”, и гиперпараметры DBSCAN нужно подбирать шире.
- В unsupervised-экспериментах важно смотреть не только на метрики, но и на визуализацию (PCA(2D)) и здравый смысл интерпретации.
